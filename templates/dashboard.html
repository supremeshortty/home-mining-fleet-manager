<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DirtySats</title>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%2300d4ff' stroke-width='2'><rect x='4' y='4' width='16' height='16' rx='2'/><rect x='9' y='9' width='6' height='6'/><path d='M9 2v2M15 2v2M9 20v2M15 20v2M2 9h2M2 15h2M20 9h2M20 15h2'/></svg>">
</head>
<body>
    <!-- Sidebar Navigation -->
    <nav class="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-logo">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="4" y="4" width="16" height="16" rx="2"/>
                    <rect x="9" y="9" width="6" height="6"/>
                    <path d="M9 2v2M15 2v2M9 20v2M15 20v2M2 9h2M2 15h2M20 9h2M20 15h2"/>
                </svg>
            </div>
            <span class="sidebar-title">DirtySats</span>
        </div>

        <div class="sidebar-nav">
            <div class="nav-item active" data-tab="fleet">
                <span class="nav-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="3" y="3" width="7" height="7"/>
                        <rect x="14" y="3" width="7" height="7"/>
                        <rect x="14" y="14" width="7" height="7"/>
                        <rect x="3" y="14" width="7" height="7"/>
                    </svg>
                </span>
                <span class="nav-label">Fleet</span>
            </div>
            <div class="nav-item" data-tab="energy">
                <span class="nav-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
                    </svg>
                </span>
                <span class="nav-label">Energy</span>
            </div>
            <div class="nav-item" data-tab="charts">
                <span class="nav-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="20" x2="18" y2="10"/>
                        <line x1="12" y1="20" x2="12" y2="4"/>
                        <line x1="6" y1="20" x2="6" y2="14"/>
                    </svg>
                </span>
                <span class="nav-label">Charts</span>
            </div>
            <div class="nav-item" data-tab="alerts">
                <span class="nav-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/>
                        <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
                    </svg>
                </span>
                <span class="nav-label">Alerts</span>
            </div>
            <div class="nav-item" data-tab="pools">
                <span class="nav-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <ellipse cx="12" cy="5" rx="9" ry="3"/>
                        <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/>
                        <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/>
                    </svg>
                </span>
                <span class="nav-label">Pools</span>
            </div>
        </div>

        <div class="sidebar-footer">
            <button id="theme-toggle" class="theme-toggle" aria-label="Toggle theme">
                <span class="icon-sun">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"/>
                        <line x1="12" y1="1" x2="12" y2="3"/>
                        <line x1="12" y1="21" x2="12" y2="23"/>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                        <line x1="1" y1="12" x2="3" y2="12"/>
                        <line x1="21" y1="12" x2="23" y2="12"/>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
                    </svg>
                </span>
                <span class="icon-moon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                    </svg>
                </span>
                <span class="theme-label">Theme</span>
            </button>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container">
        <header>
            <div class="header-left">
                <h1>
                    <svg class="header-logo-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="4" y="4" width="16" height="16" rx="2"/>
                        <rect x="9" y="9" width="6" height="6"/>
                        <path d="M9 2v2M15 2v2M9 20v2M15 20v2M2 9h2M2 15h2M20 9h2M20 15h2"/>
                    </svg>
                    DirtySats
                </h1>
                <div class="header-subtitle">Bitcoin Mining Fleet Manager</div>
            </div>
            <div class="header-center">
                <button id="discover-btn" class="btn btn-primary">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="btn-icon">
                        <circle cx="11" cy="11" r="8"/>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"/>
                    </svg>
                    Discover Miners
                </button>
                <button id="auto-optimize-fleet-btn" class="btn btn-success">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="btn-icon">
                        <path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"/>
                        <circle cx="12" cy="12" r="3"/>
                    </svg>
                    <span id="auto-optimize-fleet-text">Auto Optimize Fleet</span>
                </button>
                <div class="live-indicator">
                    <span class="live-dot"></span>
                    <span>Live</span>
                </div>
                <span id="last-update" class="status-text">Last update: Never</span>
            </div>
            <div class="header-right">
                <button class="donate-btn" onclick="openDonationModal()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
                    </svg>
                    <span>Donate</span>
                </button>
            </div>
        </header>

        <main>
            <!-- Legacy Tab Navigation (hidden on desktop, visible on mobile) -->
            <div class="tabs">
                <button class="tab-btn active" data-tab="fleet">Fleet</button>
                <button class="tab-btn" data-tab="energy">Energy</button>
                <button class="tab-btn" data-tab="charts">Charts</button>
                <button class="tab-btn" data-tab="alerts">Alerts</button>
                <button class="tab-btn" data-tab="pools">Pools</button>
            </div>

            <!-- Fleet Tab -->
            <div id="fleet-tab" class="tab-content active">
                <!-- Fleet Statistics -->
                <section class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Total Miners</div>
                        <div class="stat-value" id="total-miners">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Online</div>
                        <div class="stat-value success" id="online-miners">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Offline</div>
                        <div class="stat-value danger" id="offline-miners">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Overheated</div>
                        <div class="stat-value warning" id="overheated-miners">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total Hashrate</div>
                        <div class="stat-value" id="total-hashrate">0 GH/s</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">
                            Total Shares
                            <select id="shares-timerange" class="stat-timerange">
                                <option value="1">Last Hour</option>
                                <option value="6">Last 6 Hours</option>
                                <option value="12">Last 12 Hours</option>
                                <option value="24" selected>Last 24 Hours</option>
                                <option value="168">Last Week</option>
                            </select>
                        </div>
                        <div class="stat-value success" id="total-shares">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Best Difficulty</div>
                        <div class="stat-value" id="best-difficulty">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">
                            Energy Used
                            <select id="power-timerange" class="stat-timerange">
                                <option value="1">Last Hour</option>
                                <option value="6">Last 6 Hours</option>
                                <option value="12">Last 12 Hours</option>
                                <option value="24" selected>Last 24 Hours</option>
                                <option value="168">Last Week</option>
                            </select>
                        </div>
                        <div class="stat-value" id="total-power">-- kWh</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Average Chip Temperature</div>
                        <div class="stat-value" id="avg-temp">0Â°C</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Fleet Efficiency <span class="help-icon" onclick="showEfficiencyTooltip(event)" title="What is J/TH?">?</span></div>
                        <div class="stat-value" id="fleet-efficiency">-- J/TH</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Solo Mining Odds</div>
                        <div class="solo-odds-details">
                            <div class="solo-odds-row">
                                <span class="solo-odds-label">Chance per block:</span>
                                <span class="solo-odds-value" id="solo-odds-block">--</span>
                            </div>
                            <div class="solo-odds-row">
                                <span class="solo-odds-label">Chance per day:</span>
                                <span class="solo-odds-value" id="solo-odds-day">--</span>
                            </div>
                            <div class="solo-odds-row">
                                <span class="solo-odds-label">Time estimate:</span>
                                <span class="solo-odds-value" id="solo-odds-time">--</span>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Fleet Performance Chart -->
                <section class="chart-section">
                    <div class="chart-header">
                        <h3>Fleet Performance - Hashrate & Temperature</h3>
                        <div class="chart-controls">
                            <select id="fleet-chart-timerange" class="chart-timerange-select">
                                <option value="1">Last Hour</option>
                                <option value="3">Last 3 Hours</option>
                                <option value="6" selected>Last 6 Hours</option>
                                <option value="12">Last 12 Hours</option>
                                <option value="24">Last 24 Hours</option>
                                <option value="168">Last Week</option>
                            </select>
                            <button id="fleet-chart-refresh" class="btn btn-secondary btn-sm">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="btn-icon">
                                    <polyline points="23 4 23 10 17 10"/>
                                    <polyline points="1 20 1 14 7 14"/>
                                    <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
                                </svg>
                                Refresh
                            </button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="fleet-combined-chart"></canvas>
                    </div>
                </section>

                <!-- Miners List -->
                <section class="miners-section">
                    <div class="miners-header">
                        <h2>Miners</h2>
                        <div class="miners-header-controls">
                            <!-- Group Filter -->
                            <div class="group-filter">
                                <select id="group-filter-select" onchange="filterByGroup(this.value)">
                                    <option value="">All Groups</option>
                                </select>
                            </div>
                            <!-- Manage Groups Button -->
                            <button id="manage-groups-btn" class="btn btn-secondary btn-sm" onclick="openGroupsModal()">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="btn-icon">
                                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                                    <circle cx="9" cy="7" r="4"/>
                                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                                    <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                                </svg>
                                <span>Groups</span>
                            </button>
                            <!-- Batch Select Button -->
                            <button id="batch-select-btn" class="btn btn-secondary btn-sm" onclick="toggleBatchSelectionMode()">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="btn-icon">
                                    <polyline points="9 11 12 14 22 4"/>
                                    <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/>
                                </svg>
                                <span>Select</span>
                            </button>
                        </div>
                    </div>

                    <!-- Batch Action Toolbar (hidden by default) -->
                    <div id="batch-toolbar" class="batch-toolbar" style="display: none;">
                        <div class="batch-info">
                            <span id="batch-selected-count">0</span> miners selected
                            <button class="btn-link" onclick="selectAllMiners()">Select All</button>
                            <button class="btn-link" onclick="deselectAllMiners()">Deselect All</button>
                        </div>
                        <div class="batch-actions">
                            <button class="btn btn-sm btn-warning" onclick="batchRestart()">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="btn-icon">
                                    <polyline points="23 4 23 10 17 10"/>
                                    <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
                                </svg>
                                Restart
                            </button>
                            <button class="btn btn-sm btn-primary" onclick="batchApplyFrequency()">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="btn-icon">
                                    <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
                                </svg>
                                Set Frequency
                            </button>
                            <button class="btn btn-sm btn-primary" onclick="batchApplyFanSpeed()">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="btn-icon">
                                    <path d="M9.59 4.59A2 2 0 1 1 11 8H2m10.59 11.41A2 2 0 1 0 14 16H2m15.73-8.27A2.5 2.5 0 1 1 19.5 12H2"/>
                                </svg>
                                Set Fan
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="batchRemove()">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="btn-icon">
                                    <polyline points="3 6 5 6 21 6"/>
                                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                                </svg>
                                Remove
                            </button>
                        </div>
                    </div>

                    <div id="miners-container">
                        <p class="loading">Loading miners...</p>
                    </div>
                </section>
            </div>

            <!-- Energy Tab -->
            <div id="energy-tab" class="tab-content">
                <!-- Energy Configuration -->
                <section class="energy-config-section">
                    <h2>Energy Configuration</h2>
                    <div class="config-card">
                        <h3>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="section-icon">
                                <circle cx="12" cy="12" r="10"/>
                                <line x1="2" y1="12" x2="22" y2="12"/>
                                <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
                            </svg>
                            Utility Rate Configuration
                        </h3>

                        <!-- Tab buttons for OpenEI vs Manual -->
                        <div class="rate-config-tabs">
                            <button type="button" class="rate-tab active" data-tab="openei">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="btn-icon-sm">
                                    <circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/>
                                </svg>
                                Search Utility Database
                            </button>
                            <button type="button" class="rate-tab" data-tab="manual">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="btn-icon-sm">
                                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                                </svg>
                                Enter Rates Manually
                            </button>
                        </div>

                        <!-- OpenEI Search Panel -->
                        <div id="openei-panel" class="rate-panel active">
                            <!-- API Key Configuration -->
                            <div id="api-key-section" class="api-key-section">
                                <div class="api-key-header">
                                    <h4>OpenEI API Key</h4>
                                    <span id="api-key-status" class="api-key-status"></span>
                                </div>
                                <p class="panel-description">
                                    To search utility rates, you need a free API key from OpenEI (maintained by NREL).
                                    Each user should get their own key.
                                </p>
                                <div id="api-key-form" class="api-key-form">
                                    <div class="api-key-steps">
                                        <p><strong>Setup Instructions:</strong></p>
                                        <ol>
                                            <li>Visit <a href="https://openei.org/services/api/signup" target="_blank">OpenEI API Signup</a></li>
                                            <li>Create a free account and get your API key</li>
                                            <li>Paste your key below and click Save</li>
                                        </ol>
                                    </div>
                                    <div class="form-group">
                                        <label for="openei-api-key">Your API Key:</label>
                                        <div class="api-key-input-wrapper">
                                            <input type="password" id="openei-api-key" placeholder="Paste your OpenEI API key here..." autocomplete="off">
                                            <button type="button" id="toggle-api-key-visibility" class="btn btn-icon-only" title="Show/Hide">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
                                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                                                    <circle cx="12" cy="12" r="3"/>
                                                </svg>
                                            </button>
                                            <button type="button" id="save-api-key" class="btn btn-primary btn-sm">Save Key</button>
                                        </div>
                                    </div>
                                </div>
                                <p class="panel-hint">
                                    Don't want to set up an API key? Use the <strong>Manual Entry</strong> tab instead to enter your rates directly.
                                </p>
                            </div>

                            <hr class="section-divider">

                            <!-- Search Section (shown when API key is configured) -->
                            <div id="utility-search-section">
                                <p class="panel-description">
                                    Search the <a href="https://openei.org/wiki/Utility_Rate_Database" target="_blank">OpenEI Utility Rate Database</a> for official utility rates.
                                </p>

                                <div class="form-group">
                                    <label for="utility-search">Search for your utility:</label>
                                    <div class="search-input-wrapper">
                                        <input type="text" id="utility-search" placeholder="e.g., Xcel Energy, PG&E, ConEd..." autocomplete="off">
                                        <button type="button" id="utility-search-btn" class="btn btn-secondary btn-sm">Search</button>
                                    </div>
                                </div>
                            </div>

                            <!-- Search Results -->
                            <div id="utility-search-results" class="search-results" style="display: none;">
                                <h4>Select Your Utility:</h4>
                                <div id="utility-list" class="utility-list"></div>
                            </div>

                            <!-- Rate Plans -->
                            <div id="rate-plans-container" style="display: none;">
                                <h4>Select Your Rate Plan:</h4>
                                <p class="panel-hint">Choose the rate plan that matches your utility bill. If unsure, look for "Residential" or "Time of Use" plans.</p>
                                <div id="rate-plans-list" class="rate-plans-list"></div>
                            </div>

                            <!-- Selected Rate Preview -->
                            <div id="rate-preview" class="rate-preview" style="display: none;">
                                <h4>Rate Schedule Preview:</h4>
                                <div id="rate-preview-content"></div>
                                <button type="button" id="apply-openei-rate" class="btn btn-primary">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="btn-icon">
                                        <polyline points="20 6 9 17 4 12"/>
                                    </svg>
                                    Apply This Rate Plan
                                </button>
                            </div>
                        </div>

                        <!-- Manual Entry Panel -->
                        <div id="manual-panel" class="rate-panel">
                            <p class="panel-description">
                                Enter your rates manually if your utility isn't in the database, or if you have a custom rate plan.
                                Check your utility bill or website for accurate rates.
                            </p>

                            <form id="manual-rate-form">
                                <div class="form-group">
                                    <label for="manual-utility-name">Utility Name (optional):</label>
                                    <input type="text" id="manual-utility-name" placeholder="e.g., My Local Utility">
                                </div>

                                <div class="rate-type-toggle">
                                    <label>Rate Type:</label>
                                    <div class="toggle-buttons">
                                        <button type="button" class="toggle-btn active" data-type="tou">Time-of-Use (TOU)</button>
                                        <button type="button" class="toggle-btn" data-type="flat">Flat Rate</button>
                                    </div>
                                </div>

                                <!-- TOU Rate Entry -->
                                <div id="tou-rate-entry" class="rate-entry-section">
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label for="manual-peak-rate">Peak Rate ($/kWh):</label>
                                            <input type="number" id="manual-peak-rate" step="0.001" min="0" placeholder="e.g., 0.18" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="manual-offpeak-rate">Off-Peak Rate ($/kWh):</label>
                                            <input type="number" id="manual-offpeak-rate" step="0.001" min="0" placeholder="e.g., 0.08" required>
                                        </div>
                                    </div>
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label for="manual-peak-start">Peak Hours Start:</label>
                                            <input type="time" id="manual-peak-start" value="14:00" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="manual-peak-end">Peak Hours End:</label>
                                            <input type="time" id="manual-peak-end" value="19:00" required>
                                        </div>
                                    </div>
                                </div>

                                <!-- Flat Rate Entry -->
                                <div id="flat-rate-entry" class="rate-entry-section" style="display: none;">
                                    <div class="form-group">
                                        <label for="manual-flat-rate">Energy Rate ($/kWh):</label>
                                        <input type="number" id="manual-flat-rate" step="0.001" min="0" placeholder="e.g., 0.12">
                                    </div>
                                </div>

                                <button type="submit" class="btn btn-primary">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="btn-icon">
                                        <polyline points="20 6 9 17 4 12"/>
                                    </svg>
                                    Apply Manual Rates
                                </button>
                            </form>
                        </div>
                    </div>
                </section>

                <!-- Current Rate & Schedule -->
                <section class="rate-info-section">
                    <h2>Current Status</h2>
                    <div class="stats-grid">
                        <div class="stat-card rate-period-card" id="rate-period-card">
                            <div class="stat-label">Current Period</div>
                            <div class="rate-period-indicator" id="rate-period-indicator">
                                <span class="period-badge" id="period-badge">--</span>
                                <span class="period-time" id="period-time-remaining">--</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Current Rate</div>
                            <div class="stat-value" id="current-rate">$0.12/kWh</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Energy Today <span class="data-badge actual">Actual</span></div>
                            <div class="stat-value" id="energy-today">0 kWh</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Cost Today <span class="data-badge actual">Actual</span></div>
                            <div class="stat-value" id="cost-today">$0.00</div>
                        </div>
                    </div>
                </section>

                <!-- Energy Consumption History Chart -->
                <section class="energy-chart-section">
                    <div class="chart-header">
                        <h3>Energy Consumption History</h3>
                        <div class="chart-controls">
                            <select id="energy-chart-timerange" class="chart-timerange-select">
                                <option value="24">Last 24 Hours</option>
                                <option value="168" selected>Last 7 Days</option>
                                <option value="720">Last 30 Days</option>
                            </select>
                            <button id="energy-chart-refresh" class="btn btn-secondary btn-sm">Refresh</button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="energy-consumption-chart"></canvas>
                    </div>
                    <div class="energy-chart-summary" id="energy-chart-summary">
                        <div class="summary-item">
                            <span class="summary-label">Total Energy</span>
                            <span class="summary-value" id="energy-chart-total">-- kWh</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Total Cost</span>
                            <span class="summary-value" id="energy-chart-cost">$--</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Avg Daily</span>
                            <span class="summary-value" id="energy-chart-avg">-- kWh</span>
                        </div>
                    </div>
                </section>

                <!-- Profitability Calculator -->
                <section class="profitability-section">
                    <h2>Profitability</h2>
                    <div id="profitability-container">
                        <p class="loading">Calculating profitability...</p>
                    </div>
                </section>

                <!-- Rate Schedule - Collapsible -->
                <section class="collapsible-section collapsed" id="rate-schedule-section">
                    <div class="collapsible-header">
                        <h2>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="section-icon">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                                <line x1="16" y1="2" x2="16" y2="6"/>
                                <line x1="8" y1="2" x2="8" y2="6"/>
                                <line x1="3" y1="10" x2="21" y2="10"/>
                            </svg>
                            Rate Schedule
                        </h2>
                        <svg class="collapsible-toggle" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="6 9 12 15 18 9"/>
                        </svg>
                    </div>
                    <div class="collapsible-content">
                        <div id="rate-schedule-container">
                            <p class="loading">Loading rate schedule...</p>
                        </div>
                    </div>
                </section>

                <!-- Automated Mining Control - Collapsible -->
                <section class="collapsible-section collapsed" id="mining-schedule-section">
                    <div class="collapsible-header">
                        <h2>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="section-icon">
                                <path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"/>
                                <circle cx="12" cy="12" r="4"/>
                            </svg>
                            Automated Mining Control
                        </h2>
                        <svg class="collapsible-toggle" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="6 9 12 15 18 9"/>
                        </svg>
                    </div>
                    <div class="collapsible-content">
                        <div class="mining-control-panel">
                            <div class="control-intro">
                                <p>Set how your miners behave during different electricity pricing periods. Your fleet will automatically adjust based on your rate schedule.</p>
                            </div>

                            <form id="mining-schedule-form" class="mining-schedule-redesign">
                                <!-- Peak Period Control -->
                                <div class="period-control-card peak">
                                    <div class="period-header">
                                        <div class="period-badge-lg peak">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" width="20" height="20">
                                                <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
                                            </svg>
                                            PEAK HOURS
                                        </div>
                                        <span class="period-rate-preview" id="peak-rate-preview">Expensive electricity</span>
                                    </div>
                                    <div class="period-description">
                                        When electricity is most expensive, reduce power consumption to save money
                                    </div>
                                    <div class="control-options">
                                        <label class="control-option">
                                            <input type="radio" name="peak-action" value="off" checked>
                                            <div class="option-card">
                                                <div class="option-icon off">
                                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <circle cx="12" cy="12" r="10"/>
                                                        <line x1="4.93" y1="4.93" x2="19.07" y2="19.07"/>
                                                    </svg>
                                                </div>
                                                <div class="option-content">
                                                    <span class="option-title">Turn OFF</span>
                                                    <span class="option-desc">Stop mining completely</span>
                                                </div>
                                            </div>
                                        </label>
                                        <label class="control-option">
                                            <input type="radio" name="peak-action" value="reduce">
                                            <div class="option-card">
                                                <div class="option-icon reduce">
                                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                                                    </svg>
                                                </div>
                                                <div class="option-content">
                                                    <span class="option-title">Reduce Power</span>
                                                    <span class="option-desc">Mine at lower frequency</span>
                                                </div>
                                            </div>
                                        </label>
                                    </div>
                                    <div class="frequency-input-group hidden" id="peak-freq-group">
                                        <label for="high-rate-frequency">Frequency during peak (MHz)</label>
                                        <div class="freq-slider-container">
                                            <input type="range" id="peak-freq-slider" min="100" max="600" value="400" class="freq-slider">
                                            <input type="number" id="high-rate-frequency" value="400" min="100" max="600" class="freq-number">
                                        </div>
                                        <div class="freq-labels">
                                            <span>100 MHz (min power)</span>
                                            <span>600 MHz (max power)</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Off-Peak Period Control -->
                                <div class="period-control-card offpeak">
                                    <div class="period-header">
                                        <div class="period-badge-lg offpeak">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" width="20" height="20">
                                                <circle cx="12" cy="12" r="5"/>
                                                <line x1="12" y1="1" x2="12" y2="3"/>
                                                <line x1="12" y1="21" x2="12" y2="23"/>
                                                <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
                                                <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                                                <line x1="1" y1="12" x2="3" y2="12"/>
                                                <line x1="21" y1="12" x2="23" y2="12"/>
                                                <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
                                                <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
                                            </svg>
                                            OFF-PEAK HOURS
                                        </div>
                                        <span class="period-rate-preview success" id="offpeak-rate-preview">Cheap electricity</span>
                                    </div>
                                    <div class="period-description">
                                        When electricity is cheapest, maximize your mining output
                                    </div>
                                    <div class="control-options">
                                        <label class="control-option">
                                            <input type="radio" name="offpeak-action" value="max" checked>
                                            <div class="option-card">
                                                <div class="option-icon max">
                                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/>
                                                        <polyline points="17 6 23 6 23 12"/>
                                                    </svg>
                                                </div>
                                                <div class="option-content">
                                                    <span class="option-title">MAX Power</span>
                                                    <span class="option-desc">Run at full capacity</span>
                                                </div>
                                            </div>
                                        </label>
                                        <label class="control-option">
                                            <input type="radio" name="offpeak-action" value="custom">
                                            <div class="option-card">
                                                <div class="option-icon custom">
                                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <circle cx="12" cy="12" r="3"/>
                                                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                                                    </svg>
                                                </div>
                                                <div class="option-content">
                                                    <span class="option-title">Custom</span>
                                                    <span class="option-desc">Set specific frequency</span>
                                                </div>
                                            </div>
                                        </label>
                                    </div>
                                    <div class="frequency-input-group hidden" id="offpeak-freq-group">
                                        <label for="low-rate-frequency">Frequency during off-peak (MHz)</label>
                                        <div class="freq-slider-container">
                                            <input type="range" id="offpeak-freq-slider" min="100" max="600" value="600" class="freq-slider offpeak">
                                            <input type="number" id="low-rate-frequency" value="0" min="0" max="600" class="freq-number">
                                        </div>
                                        <div class="freq-labels">
                                            <span>100 MHz (min)</span>
                                            <span>600 MHz (max)</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Shutdown Threshold (Advanced) -->
                                <div class="advanced-control">
                                    <div class="advanced-header" onclick="toggleAdvancedControl(this)">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                                            <polyline points="6 9 12 15 18 9"/>
                                        </svg>
                                        Advanced: Rate Threshold Override
                                    </div>
                                    <div class="advanced-content hidden">
                                        <div class="threshold-control">
                                            <label for="max-rate-threshold">
                                                Emergency shutoff when rate exceeds:
                                            </label>
                                            <div class="threshold-input-group">
                                                <span class="input-prefix">$</span>
                                                <input type="number" id="max-rate-threshold" step="0.01" value="0.25" min="0">
                                                <span class="input-suffix">/kWh</span>
                                            </div>
                                            <small class="form-hint-subtle">Miners will turn off completely if electricity exceeds this rate, regardless of peak/off-peak schedule</small>
                                        </div>
                                    </div>
                                </div>

                                <button type="submit" class="btn btn-primary btn-lg">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="btn-icon">
                                        <path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"/>
                                        <circle cx="12" cy="12" r="3"/>
                                    </svg>
                                    Apply Automation Rules
                                </button>
                            </form>
                        </div>
                    </div>
                </section>

                <!-- Strategy Optimizer - Collapsible -->
                <section class="collapsible-section collapsed" id="ai-simulation-section">
                    <div class="collapsible-header">
                        <h2>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="section-icon">
                                <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/>
                                <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
                            </svg>
                            Strategy Optimizer
                        </h2>
                        <svg class="collapsible-toggle" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="6 9 12 15 18 9"/>
                        </svg>
                    </div>
                    <div class="collapsible-content">
                        <div class="optimizer-intro">
                            <div class="optimizer-badge">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
                                    <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
                                </svg>
                                Based on your rate schedule
                            </div>
                            <p class="optimizer-description">Compare mining strategies calculated from your actual energy rates. The recommended strategy maximizes your profit.</p>
                        </div>
                        <div id="simulation-strategies" class="strategy-optimizer-grid">
                            <div class="loading-simulation">
                                <div class="loading-spinner"></div>
                                <p>Calculating optimal strategies...</p>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Charts Tab -->
            <div id="charts-tab" class="tab-content">
                <section class="chart-controls-section">
                    <div class="section-header-with-actions">
                        <div>
                            <h2>Historical Data</h2>
                            <p class="section-hint">Each chart has its own time range selector. Data refreshes automatically every 30 seconds.</p>
                        </div>
                        <div class="export-buttons">
                            <button class="btn btn-secondary btn-sm" onclick="exportData('miners', 'csv')">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="btn-icon">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                    <polyline points="7 10 12 15 17 10"/>
                                    <line x1="12" y1="15" x2="12" y2="3"/>
                                </svg>
                                Export Miners
                            </button>
                            <button class="btn btn-secondary btn-sm" onclick="exportData('history', 'csv')">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="btn-icon">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                    <polyline points="7 10 12 15 17 10"/>
                                    <line x1="12" y1="15" x2="12" y2="3"/>
                                </svg>
                                Export History
                            </button>
                            <button class="btn btn-secondary btn-sm" onclick="exportData('profitability', 'csv')">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="btn-icon">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                    <polyline points="7 10 12 15 17 10"/>
                                    <line x1="12" y1="15" x2="12" y2="3"/>
                                </svg>
                                Export Profitability
                            </button>
                        </div>
                    </div>
                </section>

                <!-- Combined Hashrate & Temperature Chart -->
                <section class="chart-section">
                    <div class="chart-header">
                        <h3>Fleet Performance - Hashrate & Temperature</h3>
                        <div class="chart-controls">
                            <select id="combined-chart-timerange" class="chart-timerange-select">
                                <option value="1">Last Hour</option>
                                <option value="6" selected>Last 6 Hours</option>
                                <option value="24">Last 24 Hours</option>
                                <option value="168">Last Week</option>
                            </select>
                            <button id="combined-chart-refresh" class="btn btn-secondary btn-sm">Refresh</button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="combined-chart"></canvas>
                    </div>
                </section>

                <!-- Power Chart -->
                <section class="chart-section">
                    <div class="chart-header">
                        <h3>Power Consumption History</h3>
                        <div class="chart-controls">
                            <select id="power-chart-timerange" class="chart-timerange-select">
                                <option value="1">Last Hour</option>
                                <option value="6" selected>Last 6 Hours</option>
                                <option value="24">Last 24 Hours</option>
                                <option value="168">Last Week</option>
                            </select>
                            <button id="power-chart-refresh" class="btn btn-secondary btn-sm">Refresh</button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="power-chart"></canvas>
                    </div>
                </section>

                <!-- Profitability Chart -->
                <section class="chart-section">
                    <div class="chart-header">
                        <h3>Profitability Trend</h3>
                        <div class="chart-controls">
                            <select id="profitability-chart-timerange" class="chart-timerange-select">
                                <option value="7" selected>Last Week</option>
                                <option value="14">Last 2 Weeks</option>
                                <option value="30">Last 30 Days</option>
                            </select>
                            <button id="profitability-chart-refresh" class="btn btn-secondary btn-sm">Refresh</button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="profitability-chart"></canvas>
                    </div>
                </section>

                <!-- Efficiency Chart -->
                <section class="chart-section">
                    <div class="chart-header">
                        <h3>Mining Efficiency - Hashrate per Watt</h3>
                        <div class="chart-controls">
                            <select id="efficiency-chart-timerange" class="chart-timerange-select">
                                <option value="1">Last Hour</option>
                                <option value="6" selected>Last 6 Hours</option>
                                <option value="24">Last 24 Hours</option>
                            </select>
                            <button id="efficiency-chart-refresh" class="btn btn-secondary btn-sm">Refresh</button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="efficiency-chart"></canvas>
                    </div>
                </section>

                <!-- Shares Chart -->
                <section class="chart-section">
                    <div class="chart-header">
                        <h3>Shares Accepted vs Rejected</h3>
                        <div class="chart-controls">
                            <select id="shares-chart-timerange" class="chart-timerange-select">
                                <option value="24" selected>Last 24 Hours</option>
                                <option value="168">Last Week</option>
                            </select>
                            <button id="shares-chart-refresh" class="btn btn-secondary btn-sm">Refresh</button>
                        </div>
                    </div>
                    <div class="chart-container" style="height: 300px;">
                        <canvas id="shares-chart"></canvas>
                    </div>
                </section>

                <!-- Performance Metrics -->
                <section class="chart-section">
                    <h3>Current Performance Metrics</h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-label">Fleet Efficiency <span class="help-icon" onclick="showEfficiencyTooltip(event)" title="What is J/TH?">?</span></div>
                            <div class="stat-value" id="fleet-efficiency">0 J/TH</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Accepted Shares</div>
                            <div class="stat-value success" id="total-accepted-shares">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Rejected Shares</div>
                            <div class="stat-value danger" id="total-rejected-shares">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Accept Rate</div>
                            <div class="stat-value success" id="accept-rate">0%</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Avg Temp</div>
                            <div class="stat-value" id="charts-avg-temp">0Â°C</div>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Alerts Tab -->
            <div id="alerts-tab" class="tab-content">
                <section class="alert-config-section">
                    <h2>Telegram Alert Configuration</h2>
                    <div class="config-card">
                        <h3>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="section-icon">
                                <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/>
                            </svg>
                            Telegram Bot Setup
                        </h3>
                        <p class="help-text">
                            <strong>Step 1:</strong> Create bot with <a href="https://t.me/BotFather" target="_blank">@BotFather</a><br>
                            <strong>Step 2:</strong> Get Chat ID from getUpdates API<br>
                            <strong>Step 3:</strong> Enter your details below
                        </p>
                        <form id="telegram-alert-form">
                            <div class="form-group">
                                <label for="telegram-bot-token">Bot Token:</label>
                                <input type="text" id="telegram-bot-token" placeholder="1234567890:ABCdef..." required>
                            </div>
                            <div class="form-group">
                                <label for="telegram-chat-id">Chat ID:</label>
                                <input type="text" id="telegram-chat-id" placeholder="123456789" required>
                            </div>
                            <button type="submit" class="btn btn-primary">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="btn-icon">
                                    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                                    <polyline points="17 21 17 13 7 13 7 21"/>
                                    <polyline points="7 3 7 8 15 8"/>
                                </svg>
                                Save Configuration
                            </button>
                            <button type="button" id="test-telegram-btn" class="btn btn-secondary">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="btn-icon">
                                    <line x1="22" y1="2" x2="11" y2="13"/>
                                    <polygon points="22 2 15 22 11 13 2 9 22 2"/>
                                </svg>
                                Send Test Alert
                            </button>
                        </form>
                    </div>
                </section>

                <section class="alert-history-section">
                    <h2>Recent Alerts</h2>
                    <div id="alert-history-container">
                        <p class="loading">Loading alert history...</p>
                    </div>
                </section>
            </div>

            <!-- Pools Tab -->
            <div id="pools-tab" class="tab-content">
                <section class="pools-section">
                    <h2>Mining Pool Configuration</h2>
                    <p class="help-text">Manage mining pools for each miner in your fleet.</p>
                    <div id="pools-container">
                        <p class="loading">Loading pool configurations...</p>
                    </div>
                </section>
            </div>
        </main>

        <div id="alert-box" class="alert" style="display: none;"></div>
    </div>

    <!-- Miner Detail Modal - Unique Tabbed Dashboard Layout -->
    <div id="miner-detail-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content miner-detail-modal">
            <!-- Compact Header with Status Ring -->
            <div class="miner-modal-header">
                <button class="modal-close-btn" onclick="closeMinerDetail()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
                <div class="miner-identity">
                    <div class="miner-avatar" id="modal-miner-status">
                        <div class="avatar-ring"></div>
                        <span class="avatar-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="4" y="4" width="16" height="16" rx="2"/>
                                <rect x="9" y="9" width="6" height="6"/>
                            </svg>
                        </span>
                    </div>
                    <div class="miner-info">
                        <h2 id="modal-miner-name">Miner Name</h2>
                        <span class="miner-type-label" id="modal-miner-type">BitAxe Ultra</span>
                        <span class="miner-ip-badge" id="modal-miner-ip">192.168.1.100</span>
                    </div>
                </div>
                <button class="webui-btn" onclick="openMinerWebUI()" title="Open Web UI">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
                        <polyline points="15 3 21 3 21 9"/>
                        <line x1="10" y1="14" x2="21" y2="3"/>
                    </svg>
                </button>
            </div>

            <!-- Tab Navigation -->
            <div class="miner-tabs">
                <button class="miner-tab active" data-tab="overview" onclick="switchMinerTab('overview')">Overview</button>
                <button class="miner-tab" data-tab="performance" onclick="switchMinerTab('performance')">Performance</button>
                <button class="miner-tab" data-tab="tuning" onclick="switchMinerTab('tuning')">Tuning</button>
            </div>

            <!-- Tab Content -->
            <div class="miner-tab-content">
                <!-- OVERVIEW TAB -->
                <div class="miner-tab-pane active" id="tab-overview">
                    <!-- Primary Metric - Large Hashrate Display -->
                    <div class="primary-metric">
                        <div class="metric-ring">
                            <svg viewBox="0 0 120 120">
                                <circle cx="60" cy="60" r="54" class="ring-bg"/>
                                <circle cx="60" cy="60" r="54" class="ring-progress" id="hashrate-ring"/>
                            </svg>
                            <div class="metric-center">
                                <span class="metric-value" id="modal-hashrate">0</span>
                                <span class="metric-unit" id="modal-hashrate-unit">TH/s</span>
                            </div>
                        </div>
                        <div class="metric-label">Real Hashrate</div>
                    </div>

                    <!-- Stats Grid - 2x3 layout -->
                    <div class="stats-mosaic">
                        <div class="mosaic-tile temperature">
                            <div class="tile-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M14 14.76V3.5a2.5 2.5 0 0 0-5 0v11.26a4.5 4.5 0 1 0 5 0z"/>
                                </svg>
                            </div>
                            <div class="tile-content">
                                <span class="tile-value" id="modal-temp">0Â°C</span>
                                <span class="tile-label">Chip Temp</span>
                            </div>
                        </div>
                        <div class="mosaic-tile power">
                            <div class="tile-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
                                </svg>
                            </div>
                            <div class="tile-content">
                                <span class="tile-value" id="modal-power">0 W</span>
                                <span class="tile-label">Power</span>
                            </div>
                        </div>
                        <div class="mosaic-tile efficiency">
                            <div class="tile-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"/>
                                    <polyline points="12 6 12 12 16 14"/>
                                </svg>
                            </div>
                            <div class="tile-content">
                                <span class="tile-value" id="modal-efficiency">0 J/TH</span>
                                <span class="tile-label">Efficiency <span class="help-icon" onclick="showEfficiencyTooltip(event)" title="What is J/TH?">?</span></span>
                            </div>
                        </div>
                        <div class="mosaic-tile shares">
                            <div class="tile-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                                    <polyline points="22 4 12 14.01 9 11.01"/>
                                </svg>
                            </div>
                            <div class="tile-content">
                                <span class="tile-value" id="modal-shares">0</span>
                                <span class="tile-label">Shares</span>
                            </div>
                        </div>
                        <div class="mosaic-tile fan">
                            <div class="tile-icon spinning">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="3"/>
                                    <path d="M12 1v4M12 19v4M4.22 4.22l2.83 2.83M16.95 16.95l2.83 2.83M1 12h4M19 12h4"/>
                                </svg>
                            </div>
                            <div class="tile-content">
                                <span class="tile-value" id="modal-fan-percent">0%</span>
                                <span class="tile-label">Fan</span>
                            </div>
                        </div>
                        <div class="mosaic-tile uptime">
                            <div class="tile-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"/>
                                    <polyline points="12 6 12 12 16 10"/>
                                </svg>
                            </div>
                            <div class="tile-content">
                                <span class="tile-value" id="modal-uptime">0h</span>
                                <span class="tile-label">Uptime</span>
                            </div>
                        </div>
                    </div>

                    <!-- Pool Status Bar -->
                    <div class="pool-bar">
                        <div class="pool-indicator" id="modal-pool-status">
                            <span class="pool-dot"></span>
                            <span class="pool-text">Pool Connected</span>
                        </div>
                        <span class="pool-url" id="modal-pool-url">stratum+tcp://...</span>
                    </div>
                </div>

                <!-- PERFORMANCE TAB -->
                <div class="miner-tab-pane" id="tab-performance">
                    <!-- Best Difficulty Card -->
                    <div class="perf-highlight">
                        <div class="highlight-label">Best Difficulty</div>
                        <div class="highlight-value" id="modal-best-diff">0</div>
                        <div class="highlight-sub">Session: <span id="modal-session-diff">0</span></div>
                    </div>

                    <!-- Live Metrics -->
                    <div class="live-metrics">
                        <h4>Live Readings</h4>
                        <div class="live-grid">
                            <div class="live-item">
                                <span class="live-label">Hashrate</span>
                                <span class="live-value" id="modal-perf-hashrate">0 TH/s</span>
                            </div>
                            <div class="live-item">
                                <span class="live-label">Chip Temp</span>
                                <span class="live-value" id="modal-perf-temp">0Â°C</span>
                            </div>
                            <div class="live-item">
                                <span class="live-label">VR Temp</span>
                                <span class="live-value" id="modal-vr-temp">--Â°C</span>
                            </div>
                            <div class="live-item">
                                <span class="live-label">Power</span>
                                <span class="live-value" id="modal-perf-power">0 W</span>
                            </div>
                            <div class="live-item">
                                <span class="live-label">Current</span>
                                <span class="live-value" id="modal-perf-current">0 A</span>
                            </div>
                            <div class="live-item">
                                <span class="live-label">Daily Energy</span>
                                <span class="live-value" id="modal-kwh-day">0 kWh</span>
                            </div>
                            <div class="live-item">
                                <span class="live-label">Fan RPM</span>
                                <span class="live-value" id="modal-fan-rpm">0</span>
                            </div>
                            <div class="live-item">
                                <span class="live-label">WiFi Signal</span>
                                <span class="live-value" id="modal-wifi-signal">-65 dBm</span>
                            </div>
                            <div class="live-item solo-odds-item">
                                <span class="live-label">Per Block</span>
                                <span class="live-value" id="modal-solo-block">--</span>
                            </div>
                            <div class="live-item solo-odds-item">
                                <span class="live-label">Per Day</span>
                                <span class="live-value" id="modal-solo-day">--</span>
                            </div>
                            <div class="live-item solo-odds-item">
                                <span class="live-label">Time Est.</span>
                                <span class="live-value" id="modal-solo-time">--</span>
                            </div>
                        </div>
                    </div>

                    <!-- Share Stats -->
                    <div class="share-stats-redesign">
                        <h4>Share Statistics</h4>
                        <div class="share-stats-content">
                            <div class="acceptance-gauge">
                                <svg viewBox="0 0 100 100" class="gauge-svg">
                                    <!-- Background circle -->
                                    <circle cx="50" cy="50" r="42" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="8"/>
                                    <!-- Progress arc -->
                                    <circle cx="50" cy="50" r="42" fill="none" stroke="url(#gaugeGradient)" stroke-width="8"
                                            stroke-linecap="round" stroke-dasharray="264" stroke-dashoffset="0"
                                            id="acceptance-gauge-arc" transform="rotate(-90 50 50)"/>
                                    <defs>
                                        <linearGradient id="gaugeGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                            <stop offset="0%" stop-color="var(--success)"/>
                                            <stop offset="100%" stop-color="var(--cyan)"/>
                                        </linearGradient>
                                    </defs>
                                </svg>
                                <div class="gauge-center">
                                    <span class="gauge-percent" id="acceptance-rate-percent">99.8%</span>
                                    <span class="gauge-label">Accept Rate</span>
                                </div>
                            </div>
                            <div class="share-counts">
                                <div class="share-count accepted">
                                    <span class="count-icon">â</span>
                                    <div class="count-details">
                                        <span class="count-value" id="modal-pool-shares">0</span>
                                        <span class="count-label">Accepted</span>
                                    </div>
                                </div>
                                <div class="share-count rejected">
                                    <span class="count-icon">â</span>
                                    <div class="count-details">
                                        <span class="count-value" id="modal-rejected-shares">0</span>
                                        <span class="count-label">Rejected</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- TUNING TAB -->
                <div class="miner-tab-pane" id="tab-tuning">
                    <!-- Auto Optimize Section -->
                    <div class="auto-optimize-section" id="auto-optimize-section">
                        <div class="auto-optimize-card">
                            <div class="auto-optimize-header">
                                <div class="auto-optimize-icon">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"/>
                                        <circle cx="12" cy="12" r="3"/>
                                    </svg>
                                </div>
                                <div class="auto-optimize-info">
                                    <h4>Auto Optimize</h4>
                                    <p>Gradually increase frequency to reach optimal temperature for maximum efficiency.</p>
                                </div>
                            </div>
                            <div class="auto-optimize-targets">
                                <div class="target-item">
                                    <span class="target-label">Target Temp</span>
                                    <span class="target-value" id="modal-target-temp">55Â°C</span>
                                </div>
                                <div class="target-item">
                                    <span class="target-label">Current Temp</span>
                                    <span class="target-value" id="modal-current-temp-opt">--Â°C</span>
                                </div>
                                <div class="target-item">
                                    <span class="target-label">Status</span>
                                    <span class="target-value" id="modal-opt-status">Idle</span>
                                </div>
                            </div>
                            <div class="auto-optimize-progress" id="auto-optimize-progress" style="display: none;">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="opt-progress-fill" style="width: 0%"></div>
                                </div>
                                <span class="progress-text" id="opt-progress-text">Starting...</span>
                            </div>
                            <button class="btn btn-success auto-optimize-btn" id="auto-optimize-miner-btn" onclick="toggleMinerAutoOptimize()">
                                <span id="auto-optimize-miner-text"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="btn-icon"><polygon points="5 3 19 12 5 21 5 3"/></svg> Start Auto Optimize</span>
                            </button>
                        </div>
                    </div>

                    <!-- Current Settings Display -->
                    <div class="tuning-current">
                        <div class="tuning-stat">
                            <span class="tuning-label">Frequency</span>
                            <span class="tuning-value" id="modal-frequency">525 MHz</span>
                        </div>
                        <div class="tuning-divider"></div>
                        <div class="tuning-stat">
                            <span class="tuning-label">Core Voltage</span>
                            <span class="tuning-value warning" id="modal-voltage">1150 mV</span>
                        </div>
                    </div>

                    <!-- Frequency Presets -->
                    <div class="tuning-section">
                        <h4>Frequency Presets</h4>
                        <p class="tuning-hint">Adjust frequency only. Voltage remains unchanged for safety.</p>
                        <div class="preset-buttons">
                            <button class="preset-btn active" data-preset="stock" onclick="setOCPreset('stock')">
                                <span class="preset-name">Stock</span>
                                <span class="preset-freq">485 MHz</span>
                            </button>
                            <button class="preset-btn" data-preset="mild" onclick="setOCPreset('mild')">
                                <span class="preset-name">Mild</span>
                                <span class="preset-freq">525 MHz</span>
                            </button>
                            <button class="preset-btn" data-preset="med" onclick="setOCPreset('med')">
                                <span class="preset-name">Medium</span>
                                <span class="preset-freq">550 MHz</span>
                            </button>
                            <button class="preset-btn" data-preset="heavy" onclick="setOCPreset('heavy')">
                                <span class="preset-name">Heavy</span>
                                <span class="preset-freq">575 MHz</span>
                            </button>
                        </div>

                        <!-- Custom Frequency Input -->
                        <div class="custom-frequency-section">
                            <div class="custom-freq-header">
                                <span class="custom-freq-label">Custom Frequency</span>
                                <span class="freq-range-hint" id="freq-range-hint">Range: 400-700 MHz</span>
                            </div>
                            <div class="custom-freq-controls">
                                <button class="freq-adjust-btn" onclick="adjustFrequency(-25)">-25</button>
                                <div class="freq-input-wrapper">
                                    <input type="number" id="frequency-input" min="400" max="700" step="5" value="485">
                                    <span class="freq-unit">MHz</span>
                                </div>
                                <button class="freq-adjust-btn" onclick="adjustFrequency(25)">+25</button>
                                <button class="freq-apply-btn" onclick="applyFrequency()">Apply</button>
                            </div>
                        </div>
                    </div>

                    <!-- Fan Control Section -->
                    <div class="tuning-section fan-section">
                        <h4>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                                <path d="M12 12c-1.5-2.5-4-4-4-4s1.5-2.5 4-2.5 4 2.5 4 2.5-2.5 1.5-4 4z"/>
                                <path d="M12 12c2.5 1.5 4 4 4 4s2.5-1.5 2.5-4-2.5-4-2.5-4-1.5 2.5-4 4z"/>
                                <path d="M12 12c1.5 2.5 4 4 4 4s-1.5 2.5-4 2.5-4-2.5-4-2.5 2.5-1.5 4-4z"/>
                                <path d="M12 12c-2.5-1.5-4-4-4-4s-2.5 1.5-2.5 4 2.5 4 2.5 4 1.5-2.5 4-4z"/>
                                <circle cx="12" cy="12" r="2"/>
                            </svg>
                            Fan Control
                        </h4>

                        <!-- Fan Mode Selector -->
                        <div class="fan-mode-selector">
                            <button class="fan-mode-btn active" id="fan-mode-manual-btn" onclick="setFanMode('manual')">
                                <span class="mode-icon">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                                        <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"/>
                                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 1 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 1 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 1 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 1 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1Z"/>
                                    </svg>
                                </span>
                                <span class="mode-text">Manual</span>
                                <span class="mode-desc">Set exact fan speed</span>
                            </button>
                            <button class="fan-mode-btn" id="fan-mode-auto-btn" onclick="setFanMode('auto')">
                                <span class="mode-icon">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                                        <path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"/>
                                    </svg>
                                </span>
                                <span class="mode-text">Auto</span>
                                <span class="mode-desc">Target temperature</span>
                            </button>
                        </div>

                        <!-- Manual Fan Control -->
                        <div class="fan-manual-controls" id="fan-manual-controls">
                            <div class="fan-slider-container">
                                <div class="fan-slider-row">
                                    <input type="range" id="fan-speed-slider" min="20" max="100" value="50" oninput="updateFanSliderValue()">
                                    <span class="fan-speed-value" id="fan-speed-value">50%</span>
                                </div>
                                <div class="fan-speed-hints">
                                    <span>Quiet</span>
                                    <span>Balanced</span>
                                    <span>Max</span>
                                </div>
                            </div>
                            <button class="btn btn-primary fan-apply-btn" onclick="applyFanSpeed()">Apply</button>
                        </div>

                        <!-- Auto Fan Control -->
                        <div class="fan-auto-controls" id="fan-auto-controls" style="display: none;">
                            <div class="auto-fan-info">
                                <div class="auto-fan-target">
                                    <span class="target-label">Target Temperature</span>
                                    <span class="target-value" id="auto-fan-target-temp">60Â°C</span>
                                </div>
                                <p class="auto-fan-desc">Fan speed will automatically adjust to maintain optimal chip temperature for this miner type.</p>
                            </div>
                            <!-- Show when auto-tuning is managing fan -->
                            <div class="auto-tune-active-notice" id="auto-tune-fan-notice" style="display: none;">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                                    <polyline points="22 4 12 14.01 9 11.01"/>
                                </svg>
                                <span>Auto-tuning is managing fan control</span>
                            </div>
                            <!-- Show when user can manually enable auto fan -->
                            <button class="btn btn-primary fan-apply-btn" id="enable-auto-fan-btn" onclick="applyAutoFan()">Enable Auto Fan</button>
                        </div>

                        <!-- Current Fan Status -->
                        <div class="fan-status">
                            <span class="fan-status-label">Current:</span>
                            <span class="fan-status-value" id="current-fan-status">-- %</span>
                        </div>
                    </div>

                    <!-- Voltage Control Section -->
                    <div class="tuning-section voltage-section">
                        <h4>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                                <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
                            </svg>
                            Core Voltage
                        </h4>

                        <!-- Voltage Warning -->
                        <div class="voltage-warning" id="voltage-warning">
                            <div class="warning-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                                    <line x1="12" y1="9" x2="12" y2="13"/>
                                    <line x1="12" y1="17" x2="12.01" y2="17"/>
                                </svg>
                            </div>
                            <div class="warning-text">
                                <strong>Danger: Voltage Control</strong>
                                <p>Incorrect voltage can permanently damage your miner, void warranty, or cause fire hazard.</p>
                            </div>
                        </div>

                        <!-- Voltage Controls (hidden until acknowledged) -->
                        <div class="voltage-controls" id="voltage-controls" style="display: none;">
                            <div class="voltage-input-group">
                                <label for="voltage-input">Voltage (mV)</label>
                                <div class="voltage-input-row">
                                    <button class="voltage-btn" onclick="adjustVoltage(-10)">-10</button>
                                    <input type="number" id="voltage-input" min="800" max="1400" step="10" value="1150">
                                    <button class="voltage-btn" onclick="adjustVoltage(10)">+10</button>
                                </div>
                                <div class="voltage-range">
                                    <span>Safe: 1100-1200 mV</span>
                                    <span class="voltage-danger">Danger: &gt;1250 mV</span>
                                </div>
                            </div>
                            <button class="btn btn-danger" onclick="applyVoltage()">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                                    <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
                                </svg>
                                Apply Voltage
                            </button>
                        </div>

                        <!-- Acknowledge button -->
                        <div class="voltage-acknowledge" id="voltage-acknowledge">
                            <label class="acknowledge-checkbox">
                                <input type="checkbox" id="voltage-risk-checkbox" onchange="toggleVoltageControls()">
                                <span>I understand the risks and accept responsibility for any damage</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer Actions -->
            <div class="miner-modal-footer">
                <button class="btn btn-secondary btn-sm" onclick="restartMinerFromModal()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                        <polyline points="23 4 23 10 17 10"/>
                        <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
                    </svg>
                    Restart
                </button>
                <span class="footer-status" id="modal-uptime-status">Running</span>
            </div>
        </div>
    </div>

    <!-- Groups Management Modal -->
    <div id="groups-modal" class="modal-overlay" style="display: none;" onclick="closeGroupsModal(event)">
        <div class="groups-modal-content" onclick="event.stopPropagation()">
            <div class="groups-modal-header">
                <h2>Miner Groups</h2>
                <button class="modal-close-btn" onclick="closeGroupsModal()">&times;</button>
            </div>
            <div class="groups-modal-body">
                <!-- Create New Group Section -->
                <div class="create-group-section">
                    <h3>Create New Group</h3>
                    <div class="create-group-form">
                        <input type="text" id="new-group-name" placeholder="Group name (e.g., Basement, Garage)">
                        <input type="color" id="new-group-color" value="#3498db" title="Group color">
                        <button class="btn btn-primary btn-sm" onclick="createGroup()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="btn-icon">
                                <line x1="12" y1="5" x2="12" y2="19"/>
                                <line x1="5" y1="12" x2="19" y2="12"/>
                            </svg>
                            Create
                        </button>
                    </div>
                </div>

                <!-- Existing Groups List -->
                <div class="groups-list-section">
                    <h3>Your Groups</h3>
                    <div id="groups-list" class="groups-list">
                        <p class="loading">Loading groups...</p>
                    </div>
                </div>

                <!-- Assign Miners Section -->
                <div id="assign-miners-section" class="assign-miners-section" style="display: none;">
                    <h3>Assign Miners to: <span id="assign-group-name"></span></h3>
                    <div id="assign-miners-list" class="assign-miners-list"></div>
                    <div class="assign-miners-actions">
                        <button class="btn btn-secondary btn-sm" onclick="cancelAssignMiners()">Cancel</button>
                        <button class="btn btn-primary btn-sm" onclick="saveAssignedMiners()">Save</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Donation Modal -->
    <div id="donation-modal" class="modal-overlay" style="display: none;" onclick="closeDonationModal(event)">
        <div class="donation-modal-content" onclick="event.stopPropagation()">
            <!-- Power Bill Header -->
            <div class="bill-header">
                <div class="bill-company">
                    <div class="bill-logo">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
                        </svg>
                    </div>
                    <div class="bill-company-info">
                        <span class="bill-company-name">SATMAN POWER CO.</span>
                        <span class="bill-account">Account #21000000</span>
                    </div>
                </div>
                <div class="bill-status past-due">PAST DUE</div>
            </div>

            <!-- Bill Details -->
            <div class="bill-details">
                <div class="bill-row">
                    <span class="bill-label">ASIC Fleet (<span id="donation-miner-count">0</span> miners)</span>
                    <span class="bill-value"><span id="donation-power">0</span> W</span>
                </div>
                <div class="bill-row">
                    <span class="bill-label">24/7 Operation</span>
                    <span class="bill-value">720 hrs</span>
                </div>
                <div class="bill-row bill-total">
                    <span class="bill-label">Amount Due:</span>
                    <span class="bill-value bill-sats">&infin; sats</span>
                </div>
            </div>

            <!-- Subsidize Section -->
            <div class="bill-subsidize">
                <span class="subsidize-label">Subsidize</span>
                <span class="subsidize-handle">@satman's</span>
                <span class="subsidize-highlight">electric bill</span>
            </div>

            <!-- QR Code -->
            <div class="bill-qr-container" onclick="copyLightningAddress()">
                <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=lightning:amberloin26@primal.net&bgcolor=1e1e2e&color=ffffff" alt="Lightning QR" class="bill-qr">
            </div>

            <!-- Footer -->
            <div class="bill-footer">
                <span class="lightning-bolt">&#9889;</span> Lightning Network <span class="bill-dot">â¢</span> Any amount helps
            </div>
        </div>
    </div>

    <!-- Chart.js Library -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="/static/script.js"></script>

    <script>
        // Sidebar navigation
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', function() {
                const tab = this.getAttribute('data-tab');
                document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
                this.classList.add('active');
                document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
                document.getElementById(tab + '-tab').classList.add('active');
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelector(`.tab-btn[data-tab="${tab}"]`)?.classList.add('active');
                if (typeof switchTab === 'function') switchTab(tab);
            });
        });

        // Donation modal functions
        function openDonationModal() {
            const modal = document.getElementById('donation-modal');
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden';

            // Update stats from dashboard
            const minerCount = document.getElementById('total-miners')?.textContent || '0';
            const totalPower = document.getElementById('total-power')?.textContent?.replace(' W', '') || '0';
            document.getElementById('donation-miner-count').textContent = minerCount;
            document.getElementById('donation-power').textContent = totalPower;
        }

        function closeDonationModal(event) {
            if (event && event.target !== event.currentTarget) return;
            const modal = document.getElementById('donation-modal');
            modal.style.display = 'none';
            document.body.style.overflow = '';
        }

        function copyLightningAddress() {
            const address = 'amberloin26@primal.net';
            navigator.clipboard.writeText(address).then(() => {
                showAlert('Lightning address copied!', 'success');
            }).catch(() => {
                const textArea = document.createElement('textarea');
                textArea.value = address;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showAlert('Lightning address copied!', 'success');
            });
        }

        // Close on escape
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeDonationModal({target: {}, currentTarget: {}});
        });
    </script>

    <!-- Efficiency Help Tooltip -->
    <div class="efficiency-tooltip-overlay" id="efficiency-tooltip-overlay" onclick="closeEfficiencyTooltip()"></div>
    <div class="efficiency-tooltip" id="efficiency-tooltip">
        <button class="close-btn" onclick="closeEfficiencyTooltip()">&times;</button>
        <h4>â¡ Mining Efficiency Explained</h4>
        <p><strong>J/TH</strong> (Joules per Terahash) measures how much energy your miner uses to perform one terahash of computation.</p>
        <div class="formula">Efficiency = Power (W) Ã· Hashrate (TH/s)</div>
        <div class="equivalence">
            <strong>J/TH = W/TH</strong> â These are identical! Since 1 Watt = 1 Joule/second, and hashrate is in TH/<em>second</em>, the units cancel out.
        </div>
        <p><strong>Lower is better.</strong> A 15 J/TH miner uses half the energy of a 30 J/TH miner for the same hashrate.</p>
        <div class="rating-scale">
            <span class="efficiency-excellent">â Excellent</span><span>&lt; 20 J/TH (BM1370 chips)</span>
            <span class="efficiency-good">â Good</span><span>20-30 J/TH (BM1366 chips)</span>
            <span class="efficiency-average">â Average</span><span>30-50 J/TH</span>
            <span class="efficiency-poor">â Poor</span><span>50-80 J/TH</span>
            <span class="efficiency-bad">â Bad</span><span>&gt; 80 J/TH (legacy S9-era)</span>
        </div>
    </div>
</body>
</html>

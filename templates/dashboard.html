<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mining Fleet Manager</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-left">
                <h1>‚õèÔ∏è Home Mining Fleet Manager</h1>
                <div class="header-subtitle">Professional Bitcoin Mining Dashboard</div>
            </div>
            <div class="header-center">
                <button id="discover-btn" class="btn btn-primary">üîç Discover Miners</button>
                <span id="last-update" class="status-text">Last update: Never</span>
            </div>
            <div class="header-right">
                <div class="author-badge">
                    <div class="author-label">Created by</div>
                    <div class="author-handle">@satman</div>
                </div>
            </div>
        </header>

        <!-- Tab Navigation -->
        <div class="tabs">
            <button class="tab-btn active" data-tab="fleet">Fleet</button>
            <button class="tab-btn" data-tab="energy">Energy</button>
            <button class="tab-btn" data-tab="charts">Charts</button>
            <button class="tab-btn" data-tab="alerts">Alerts</button>
            <button class="tab-btn" data-tab="weather">Weather</button>
            <button class="tab-btn" data-tab="pools">Pools</button>
        </div>

        <!-- Fleet Tab -->
        <div id="fleet-tab" class="tab-content active">
            <!-- Fleet Statistics -->
            <section class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Total Miners</div>
                    <div class="stat-value" id="total-miners">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Online</div>
                    <div class="stat-value success" id="online-miners">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Offline</div>
                    <div class="stat-value danger" id="offline-miners">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Total Hashrate</div>
                    <div class="stat-value" id="total-hashrate">0 GH/s</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">
                        Total Shares
                        <select id="shares-timerange" class="stat-timerange">
                            <option value="1">Last Hour</option>
                            <option value="6">Last 6 Hours</option>
                            <option value="12">Last 12 Hours</option>
                            <option value="24" selected>Last 24 Hours</option>
                            <option value="168">Last Week</option>
                        </select>
                    </div>
                    <div class="stat-value success" id="total-shares">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Best Difficulty</div>
                    <div class="stat-value" id="best-difficulty">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">
                        Total Power
                        <select id="power-timerange" class="stat-timerange">
                            <option value="1">Last Hour</option>
                            <option value="6">Last 6 Hours</option>
                            <option value="12">Last 12 Hours</option>
                            <option value="24" selected>Last 24 Hours</option>
                            <option value="168">Last Week</option>
                        </select>
                    </div>
                    <div class="stat-value" id="total-power">0 W</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Average Chip Temperature</div>
                    <div class="stat-value" id="avg-temp">0¬∞C</div>
                </div>
            </section>

            <!-- Fleet Performance Chart -->
            <section class="chart-section">
                <div class="chart-header">
                    <h3>Fleet Performance - Hashrate & Temperature</h3>
                    <div class="chart-controls">
                        <select id="fleet-chart-timerange" class="chart-timerange-select">
                            <option value="1">Last Hour</option>
                            <option value="3">Last 3 Hours</option>
                            <option value="6" selected>Last 6 Hours</option>
                            <option value="12">Last 12 Hours</option>
                            <option value="24">Last 24 Hours</option>
                            <option value="168">Last Week</option>
                        </select>
                        <button id="fleet-chart-refresh" class="btn btn-secondary btn-sm">‚Üª Refresh</button>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="fleet-combined-chart"></canvas>
                </div>
            </section>

            <!-- Miners List -->
            <section class="miners-section">
                <h2>Miners</h2>
                <div id="miners-container">
                    <p class="loading">Loading miners...</p>
                </div>
            </section>
        </div>

        <!-- Energy Tab -->
        <div id="energy-tab" class="tab-content">
            <!-- Energy Configuration -->
            <section class="energy-config-section">
                <h2>Energy Configuration</h2>
                <div class="config-card">
                    <h3>üåç Worldwide Energy Company Selection</h3>
                    <form id="energy-config-form">
                        <div class="form-group">
                            <label for="energy-company">Energy Company or Provider:</label>
                            <select id="energy-company" name="energy_company">
                                <option value="">Select a company or enter custom...</option>

                                <optgroup label="üá∫üá∏ United States - Major Providers">
                                    <option value="Xcel Energy (Colorado)">Xcel Energy (Colorado)</option>
                                    <option value="Xcel Energy (Minnesota)">Xcel Energy (Minnesota)</option>
                                    <option value="Xcel Energy (Texas)">Xcel Energy (Texas)</option>
                                </optgroup>

                                <optgroup label="üá∫üá∏ United States - California">
                                    <option value="PG&E (California)">PG&E (Northern CA)</option>
                                    <option value="SCE (Southern California Edison)">SCE (Southern CA)</option>
                                    <option value="SDG&E (San Diego Gas & Electric)">SDG&E (San Diego)</option>
                                </optgroup>

                                <optgroup label="üá∫üá∏ United States - Texas">
                                    <option value="Oncor (Texas)">Oncor (Dallas/Fort Worth)</option>
                                    <option value="CenterPoint Energy (Texas)">CenterPoint (Houston)</option>
                                    <option value="AEP Texas">AEP Texas</option>
                                </optgroup>

                                <optgroup label="üá∫üá∏ United States - Other States">
                                    <option value="ConEd (Consolidated Edison)">ConEd (New York)</option>
                                    <option value="NYSEG (New York State Electric & Gas)">NYSEG (Upstate NY)</option>
                                    <option value="FPL (Florida Power & Light)">FPL (Florida)</option>
                                    <option value="Duke Energy Florida">Duke Energy (Florida)</option>
                                    <option value="Georgia Power">Georgia Power</option>
                                    <option value="Duke Energy Carolinas">Duke Energy (Carolinas)</option>
                                    <option value="ComEd (Commonwealth Edison)">ComEd (Illinois)</option>
                                    <option value="AEP Ohio">AEP Ohio</option>
                                    <option value="Duke Energy Ohio">Duke Energy (Ohio)</option>
                                    <option value="DTE Energy">DTE Energy (Michigan)</option>
                                    <option value="PECO Energy">PECO (Pennsylvania)</option>
                                    <option value="Seattle City Light">Seattle City Light</option>
                                    <option value="Puget Sound Energy">Puget Sound Energy (WA)</option>
                                    <option value="Portland General Electric">Portland General (Oregon)</option>
                                    <option value="NV Energy">NV Energy (Nevada)</option>
                                    <option value="APS (Arizona Public Service)">APS (Arizona)</option>
                                    <option value="Rocky Mountain Power (Utah)">Rocky Mountain (Utah)</option>
                                    <option value="Idaho Power">Idaho Power</option>
                                    <option value="NorthWestern Energy (Montana)">NorthWestern (Montana)</option>
                                    <option value="Rocky Mountain Power (Wyoming)">Rocky Mountain (Wyoming)</option>
                                </optgroup>

                                <optgroup label="üá®üá¶ Canada">
                                    <option value="Hydro-Qu√©bec (Canada)">Hydro-Qu√©bec</option>
                                    <option value="BC Hydro (Canada)">BC Hydro</option>
                                    <option value="Ontario Hydro (Canada)">Ontario Hydro</option>
                                    <option value="Alberta Electric (Canada)">Alberta Electric</option>
                                </optgroup>

                                <optgroup label="üá™üá∫ Europe">
                                    <option value="EDF (France)">EDF (France)</option>
                                    <option value="E.ON (Germany)">E.ON (Germany)</option>
                                    <option value="Enel (Italy)">Enel (Italy)</option>
                                    <option value="Iberdrola (Spain)">Iberdrola (Spain)</option>
                                    <option value="British Gas (UK)">British Gas (UK)</option>
                                    <option value="EDF Energy (UK)">EDF Energy (UK)</option>
                                    <option value="Vattenfall (Sweden)">Vattenfall (Sweden)</option>
                                    <option value="Fortum (Norway/Finland)">Fortum (Norway/Finland)</option>
                                </optgroup>

                                <optgroup label="üåè Asia-Pacific">
                                    <option value="China State Grid">China State Grid</option>
                                    <option value="TEPCO (Japan)">TEPCO (Japan)</option>
                                    <option value="KEPCO (South Korea)">KEPCO (South Korea)</option>
                                    <option value="AGL Energy (Australia)">AGL Energy (Australia)</option>
                                    <option value="Origin Energy (Australia)">Origin Energy (Australia)</option>
                                    <option value="Contact Energy (New Zealand)">Contact Energy (NZ)</option>
                                    <option value="Singapore Power">Singapore Power</option>
                                </optgroup>

                                <optgroup label="üåç Middle East & Africa">
                                    <option value="DEWA (Dubai)">DEWA (Dubai, UAE)</option>
                                    <option value="Saudi Electricity Company">Saudi Electricity</option>
                                    <option value="Eskom (South Africa)">Eskom (South Africa)</option>
                                </optgroup>

                                <optgroup label="üåé Latin America">
                                    <option value="CFE (Mexico)">CFE (Mexico)</option>
                                    <option value="Enel Chile">Enel (Chile)</option>
                                    <option value="Eletrobras (Brazil)">Eletrobras (Brazil)</option>
                                </optgroup>

                                <optgroup label="‚ùÑÔ∏è Low-Cost Mining Regions">
                                    <option value="Landsvirkjun (Iceland)">Landsvirkjun (Iceland) - Cheapest!</option>
                                </optgroup>

                                <optgroup label="‚öôÔ∏è Custom">
                                    <option value="Custom (Manual Entry)">Custom / Enter Manually</option>
                                </optgroup>
                            </select>
                        </div>

                        <!-- Custom Rate Entry (shown when Custom selected) -->
                        <div id="custom-rate-entry" style="display: none; margin-top: 24px; padding: 20px; background: rgba(247, 147, 26, 0.1); border-radius: 12px; border: 1px solid var(--border-glow);">
                            <h4 style="color: var(--primary-color); margin-bottom: 16px;">‚ö° Custom Energy Rates</h4>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="custom-rate">Standard Rate ($/kWh):</label>
                                    <input type="number" id="custom-rate" name="custom_rate" step="0.001" min="0" placeholder="e.g., 0.12">
                                </div>
                                <div class="form-group">
                                    <label for="custom-peak-rate">Peak Rate ($/kWh) - Optional:</label>
                                    <input type="number" id="custom-peak-rate" name="custom_peak_rate" step="0.001" min="0" placeholder="e.g., 0.25">
                                </div>
                                <div class="form-group">
                                    <label for="custom-offpeak-rate">Off-Peak Rate ($/kWh) - Optional:</label>
                                    <input type="number" id="custom-offpeak-rate" name="custom_offpeak_rate" step="0.001" min="0" placeholder="e.g., 0.08">
                                </div>
                            </div>
                            <p style="color: var(--text-muted); font-size: 0.85rem; margin-top: 10px;">
                                Enter your energy rates. If you have time-of-use pricing, fill in peak and off-peak rates as well.
                            </p>
                        </div>

                        <div class="location-fields">
                            <h4 style="color: var(--text-primary); margin: 20px 0 15px 0; font-size: 1rem;">üìç Your Location (Optional)</h4>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="city">City:</label>
                                    <input type="text" id="city" name="city" placeholder="e.g., Denver">
                                </div>
                                <div class="form-group">
                                    <label for="state">State/Province:</label>
                                    <input type="text" id="state" name="state" placeholder="e.g., Colorado">
                                </div>
                                <div class="form-group">
                                    <label for="country">Country:</label>
                                    <input type="text" id="country" name="country" placeholder="e.g., USA">
                                </div>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary">üíæ Apply Energy Settings</button>
                    </form>

                    <p class="help-text" style="margin-top: 20px;">
                        <strong>Tip:</strong> Select your energy provider from the list above. If your provider isn't listed, choose "Custom / Enter Manually"
                        and enter your location details. The system will use average rates for your region.
                    </p>
                </div>
            </section>

            <!-- Current Rate & Schedule -->
            <section class="rate-info-section">
                <h2>Current Status</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Current Rate</div>
                        <div class="stat-value" id="current-rate">$0.12/kWh</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Energy Today</div>
                        <div class="stat-value" id="energy-today">0 kWh</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Cost Today</div>
                        <div class="stat-value" id="cost-today">$0.00</div>
                    </div>
                </div>
            </section>

            <!-- Profitability Calculator -->
            <section class="profitability-section">
                <h2>Profitability</h2>
                <div id="profitability-container">
                    <p class="loading">Calculating profitability...</p>
                </div>
            </section>

            <!-- Rate Schedule -->
            <section class="rate-schedule-section">
                <h2>Rate Schedule</h2>
                <div id="rate-schedule-container">
                    <p class="loading">Loading rate schedule...</p>
                </div>
            </section>

            <!-- Mining Schedule Configuration -->
            <section class="mining-schedule-section">
                <h2>Mining Schedule (Frequency Control)</h2>
                <div class="config-card">
                    <p>Automatically adjust miner frequency based on energy rates:</p>
                    <form id="mining-schedule-form">
                        <div class="form-group">
                            <label for="max-rate-threshold">Turn Off When Rate Exceeds ($/kWh):</label>
                            <input type="number" id="max-rate-threshold" step="0.01" value="0.25" min="0">
                        </div>
                        <div class="form-group">
                            <label for="high-rate-frequency">Chip Frequency During Peak Rates (MHz):</label>
                            <input type="number" id="high-rate-frequency" value="0" min="0" max="600" placeholder="0 = Turn OFF miners">
                            <small style="color: var(--text-secondary); display: block; margin-top: 4px;">Set to 0 to turn miners OFF during expensive electricity. Set to a MHz value (e.g., 400) to underclock.</small>
                        </div>
                        <div class="form-group">
                            <label for="low-rate-frequency">Chip Frequency During Off-Peak Rates (MHz):</label>
                            <input type="number" id="low-rate-frequency" value="0" min="0" max="600" placeholder="0 = MAX frequency">
                            <small style="color: var(--text-secondary); display: block; margin-top: 4px;">Set to 0 to run at MAX frequency during cheap electricity. Set to a MHz value to limit frequency.</small>
                        </div>
                        <button type="submit" class="btn btn-primary">Auto-Create Schedule</button>
                    </form>
                </div>
            </section>
        </div>

        <!-- Charts Tab -->
        <div id="charts-tab" class="tab-content">
            <!-- Time Range Selector -->
            <section class="chart-controls-section">
                <h2>Historical Data</h2>
                <div class="form-group-inline">
                    <label for="chart-time-range">Time Range:</label>
                    <select id="chart-time-range">
                        <option value="6">Last 6 hours</option>
                        <option value="24" selected>Last 24 hours</option>
                        <option value="72">Last 3 days</option>
                        <option value="168">Last 7 days</option>
                    </select>
                    <button id="refresh-charts-btn" class="btn btn-secondary">Refresh</button>
                </div>
            </section>

            <!-- Combined Hashrate & Temperature Chart -->
            <section class="chart-section">
                <h3>Fleet Performance - Hashrate & Temperature</h3>
                <div class="chart-container">
                    <canvas id="combined-chart"></canvas>
                </div>
            </section>

            <!-- Power Chart -->
            <section class="chart-section">
                <h3>Power Consumption History</h3>
                <div class="chart-container">
                    <canvas id="power-chart"></canvas>
                </div>
            </section>

            <!-- Profitability Chart -->
            <section class="chart-section">
                <h3>Profitability Trend</h3>
                <div class="chart-container">
                    <canvas id="profitability-chart"></canvas>
                </div>
            </section>

            <!-- Efficiency Chart -->
            <section class="chart-section">
                <h3>Mining Efficiency - Hashrate per Watt</h3>
                <div class="chart-container">
                    <canvas id="efficiency-chart"></canvas>
                </div>
            </section>

            <!-- Shares Rate Chart -->
            <section class="chart-section">
                <h3>Shares Accepted vs Rejected</h3>
                <div class="chart-container" style="height: 300px;">
                    <canvas id="shares-chart"></canvas>
                </div>
            </section>

            <!-- Performance Metrics Grid -->
            <section class="chart-section">
                <h3>Current Performance Metrics</h3>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Fleet Efficiency</div>
                        <div class="stat-value" id="fleet-efficiency">0 GH/W</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Accept Rate</div>
                        <div class="stat-value success" id="accept-rate">0%</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Reject Rate</div>
                        <div class="stat-value" id="reject-rate">0%</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Avg Temp</div>
                        <div class="stat-value" id="charts-avg-temp">0¬∞C</div>
                    </div>
                </div>
            </section>
        </div>

        <!-- Alerts Tab -->
        <div id="alerts-tab" class="tab-content">
            <!-- Alert Configuration -->
            <section class="alert-config-section">
                <h2>Telegram Alert Configuration</h2>
                <div class="config-card">
                    <h3>üì± Telegram Bot Setup</h3>
                    <p class="help-text">
                        <strong>Step 1:</strong> Create bot with <a href="https://t.me/BotFather" target="_blank">@BotFather</a> - send <code>/newbot</code><br>
                        <strong>Step 2:</strong> Get Chat ID - send a message to your bot, then visit:<br>
                        <code>https://api.telegram.org/bot&lt;YOUR_BOT_TOKEN&gt;/getUpdates</code><br>
                        <strong>Step 3:</strong> Enter your details below and click Save
                    </p>
                    <form id="telegram-alert-form">
                        <div class="form-group">
                            <label for="telegram-bot-token">Bot Token:</label>
                            <input type="text" id="telegram-bot-token" placeholder="1234567890:ABCdefGHIjklMNOpqrsTUVwxyz" required>
                        </div>
                        <div class="form-group">
                            <label for="telegram-chat-id">Chat ID:</label>
                            <input type="text" id="telegram-chat-id" placeholder="123456789 or -123456789 for groups" required>
                        </div>
                        <button type="submit" class="btn btn-primary">üíæ Save Configuration</button>
                        <button type="button" id="test-telegram-btn" class="btn btn-secondary">üì® Send Test Alert</button>
                    </form>
                </div>
            </section>

            <!-- Alert History -->
            <section class="alert-history-section">
                <h2>Recent Alerts</h2>
                <div id="alert-history-container">
                    <p class="loading">Loading alert history...</p>
                </div>
            </section>
        </div>

        <!-- Weather Tab -->
        <div id="weather-tab" class="tab-content">
            <!-- Weather Configuration -->
            <section class="weather-config-section">
                <h2>Weather Configuration</h2>
                <div class="config-card">
                    <p>Get a free API key from <a href="https://openweathermap.org/api" target="_blank">OpenWeatherMap</a></p>
                    <form id="weather-config-form">
                        <div class="form-group">
                            <label for="weather-api-key">API Key:</label>
                            <input type="text" id="weather-api-key" placeholder="Your OpenWeatherMap API key">
                        </div>
                        <div class="form-group">
                            <label for="weather-location">Location:</label>
                            <input type="text" id="weather-location" placeholder="San Francisco,US">
                        </div>
                        <button type="submit" class="btn btn-primary">Save Configuration</button>
                    </form>
                </div>
            </section>

            <!-- Current Weather -->
            <section class="current-weather-section">
                <h2>Current Conditions</h2>
                <div id="current-weather-container">
                    <p class="loading">Weather not configured or unavailable</p>
                </div>
            </section>

            <!-- Weather Forecast -->
            <section class="weather-forecast-section">
                <h2>24-Hour Forecast</h2>
                <div id="weather-forecast-container">
                    <p class="loading">No forecast available</p>
                </div>
            </section>

            <!-- Thermal Prediction -->
            <section class="thermal-prediction-section">
                <h2>Thermal Impact Prediction</h2>
                <div id="thermal-prediction-container">
                    <p class="loading">No prediction available</p>
                </div>
            </section>

            <!-- Optimal Mining Hours -->
            <section class="optimal-hours-section">
                <h2>Optimal Mining Hours</h2>
                <div id="optimal-hours-container">
                    <p class="loading">No data available</p>
                </div>
            </section>
        </div>

        <!-- Pools Tab -->
        <div id="pools-tab" class="tab-content">
            <!-- Pool Management Section -->
            <section class="pools-section">
                <h2>Mining Pool Configuration</h2>
                <p class="help-text">Manage mining pools for each miner in your fleet. Changes are applied immediately to the selected miner.</p>

                <div id="pools-container">
                    <p class="loading">Loading pool configurations...</p>
                </div>
            </section>
        </div>

        <!-- Alert Box -->
        <div id="alert-box" class="alert" style="display: none;"></div>
    </div>

    <!-- Chart.js Library -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="/static/script.js"></script>
</body>
</html>
